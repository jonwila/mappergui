<!DOCTYPE html>
<html>
<head>

<title>LibMapper Matrix View</title>

<script src="LibMapperModel.js"></script>
<script src="views/LibMapperMatrixView.js"></script>
<script src="views/SvgGrid.js"></script>
<!-- <script src="LibMapperGUIController.js"></script> -->
<script src="js/Signal.js"></script>

<!-- jQueryUI slider -->	
<link rel="stylesheet" href="css/ui-lightness/jquery-ui-1.10.0.custom.css" />
<script src="js/jquery-1.9.0.js"></script>
<script src="js/jquery-ui-1.10.0.custom.js"></script>

<!-- View's CSS -->
<link rel="stylesheet" href="views/LibMapperMatrixView_style.css" />


<script>



var model, view;

function init(){

	model = new LibMapperModel();
	view  = new  LibMapperMatrixView(document.getElementById("view"), model);
	
	// init with fake data for now
	
	var nIn = 4, nOut = 4;
	var nsig = 0;
	for(var i=0; i<nIn;i++)
	{
		var devName = "Source " + i;
		addSourceDevice(devName);
		for(var j=0; j<4;j++)
			addDevSignal("Src Sig " + nsig++, devName);		
	}
	for(var i=0; i<nOut;i++)
	{
		var devName = "Destination " + i;
		addDestinationDevice(devName);
		for(var j=0; j<4;j++)
			addDevSignal("Dest Sig " + nsig++, devName);		
	}


	// controller (from view)  
	$("#view").on("createLink", function(e, src, dst){
		model.createLink(src, dst);
		view.updateDisplay();
	});
	$("#view").on("removeLink", function(e, src, dst){
		var linkIndex = model.getLinkIndex(src, dst);
		if(linkIndex >= 0){
			model.removeLink(linkIndex);
			view.updateDisplay();
		}
	});
	$("#view").on("createConnection", function(e, src, dst){
		model.createConnection(src, dst);
	});
	$("#view").on("removeConnection", function(e, src, dst){
		var connectionIndex = model.getConnectionIndex(src, dst);
		if(connectionIndex >= 0)
			model.removeConnection(connectionIndex);
	});



	
}

function update(event){
	alert("yes");
}

function addDestinationDevice(name)
{
	var args = new Array();
	args['name'] = name;
	args['n_inputs'] = 2;
	args['n_outputs'] = 0;
	var device = model.new_device(args);
	view.updateDisplay();
}

function addSourceDevice(name)
{
	var args = new Array();
	args['name'] = name;
	args['n_inputs'] = 0;
	args['n_outputs'] = 2;
	var device = model.new_device(args);
	view.updateDisplay();
}

function addDevSignal(name, device_name)
{
	var args = new Array(); 
	args['device_name'] = device_name;
	args['name'] = name;
	var signal = model.new_signal(args);
	view.updateDisplay();
}

function tempBtnHandler(val)
{
		if(val=="row")
			for(var j=0; j<1;j++)
				addDestinationSignal(new DestinationSignal("New Row (" + (model.rows.length+1) + ")" ), 0);
		else
			for(var j=0; j<1;j++){
				addSourceSignal(new SourceSignal("New Col (" + (model.cols.length+1) + ")" ), 0);
		}
}
</script>
</head>


<body onload="init()">
<div style="margin: 0 auto;">
	<button onclick="tempBtnHandler('row')">Add 5 Rows at 0</button>
	<!-- <INPUT TYPE="text" NAME="inputbox" id="inputbox" VALUE="0" maxlength="3"> -->
	<button onclick="tempBtnHandler('col')">Add 5 Col at 0</button><br /><br />
</div> 


	<div id="view" style="margin-top: 20px;">
</div>

<p id="out"></p>


</body>
</html>